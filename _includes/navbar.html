{%- include global_variables.html -%}

<div class="w-100 bd-navbar">
  <nav class="navbar navbar-dark navbar-expand-lg background-primary d-flex flex-wrap flex-lg-nowrap justify-content-between">
    {% comment %}
      XXX: Starting from medium screens this element is absolutely
      positioned so it's always centered even if the left dropdown menu
      grows.

      The content is hidden for screen readers because the titlebar
      contains the full book title.
    {% endcomment %}
    <div class="w-100 position-lg-absolute navbar-brand text-uppercase text-center" aria-hidden="true">
      <a href="{{ '/' | relative_url }}" class="position-relative f-28px open-sans white mb-0 text-decoration-none letter-spacing z-index-dropdown hover-white">
        {{ site.title }}
        {{ current_site_modifier | remove: ':' }}
      </a>
    </div>

    <div class="position-relative w-100 d-flex align-items-center justify-content-between">
      <div class="navbar-nav d-flex flex-row align-items-center w-100">
        <div class="nav-item">
          <a class="nav-link px-15px px-md-30px mb-0 text-uppercase font-weight-bold f-14px f-md-3 open-sans white hover-white" href="{{ '/' | relative_url }}">
            {{ t.navbar.home }}
          </a>
        </div>

        {%- include_cached toggler.html id="close" name="dropdown" type="radio" -%}

        {% comment %}
          Generate dropdown menus recursively
        {% endcomment %}
        {% for layout in site.book_layouts -%}
          {% assign posts = site.posts | where: 'layout', layout | sort: 'title' %}
          {% if posts == empty %}{% continue %}{% endif %}

          <div class="nav-item">
            <div class="nav-link px-0 mb-0">
              {%- capture toggler_content -%}
                {{ t.navbar[layout] }}
                <i class="fa fa-caret-down f-20px white ml-2" aria-hidden="true"></i>
              {%- endcapture -%}
              {%- include_cached toggler_label.html id=layout content=toggler_content class="white text-uppercase font-weight-bold f-14px f-md-3 open-sans mb-0 px-15px px-md-30px d-flex align-items-center" -%}

              {%- include_cached toggler.html id=layout name="dropdown" type="checkbox" -%}
              <div class="toggled position-absolute px-3 pt-10px pb-14px background-primary grow-vertically z-index-navbar w-100 w-md-510px left-0 left-md-auto">

                <ul class="list-unstyled mb-0">
                  {% for post in posts %}
                    <li class="mb-12px pt-12px">
                      <a class="nav-link font-weight-bold white text-nowrap f-15px hover-white" href="{{ post.url | relative_url }}">{{ post.title }}</a>
                    </li>
                  {% endfor %}
                </ul>
              </div>

              {% comment %}
                Close the menu when touching outside it
              {% endcomment %}
              <div class="toggled position-fixed w-100 left-0 h-100vh" style="z-index: 0">
                {%- include_cached toggler_related.html id=layout class="w-100 h-100" -%}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      <div class="nav-item">
        <div class="nav-link text-right px-15px px-md-30px">
          {%- capture search_content -%}
            <div class="d-none d-md-inline-flex">{{ t.navbar.search }}</div>
            <i class="fa fa-fw fa-search f-18px pl-1" aria-hidden="true"></i>
          {%- endcapture -%}
          {%- include_cached toggler_label.html id='search' class='white text-uppercase font-weight-bold f-14px f-md-3 open-sans mb-0 cursor-pointer d-flex align-items-center py-5px' content=search_content -%}

          {%- include_cached toggler.html id="search" name="dropdown" type="checkbox" -%}
          <div class="toggled position-absolute right-0 w-100 w-md-574px grow-vertically transition">
            <div class="text-left background-primary py-20px p-md-30px px-63px px-md-30px border-search border-top border-md-0 border-white">
              {% include_cached search.html t=t %}
            </div>
          </div>

          {% comment %}
            Close the menu when touching outside it
          {% endcomment %}
          <div class="toggled position-fixed w-100 left-0 h-100vh" style="z-index: 0">
            {%- include_cached toggler_related.html id="search" class="w-100 h-100 background-white-t3" -%}
          </div>
        </div>
      </div>
    </div>
  </nav>
</div>
